{% extends "base-header.html" %}
{% load static %}
{% load bilan_filters %}
{% block title %} Bilan {% endblock %}

{% block styles %} 
<link href="{% static 'style-bilan.css'%}" rel="stylesheet"/>
<script src="{% static 'sort.js' %}"></script>
<script src="{% static 'color.js' %}"></script>
<script src="{% static 'send.js' %}"></script>
{% endblock %}

{% block content %}

<div style="display: flex; align-items: center;">
    <button class="white-button" onclick="location.href = '/'"><span style="margin-right: 10px;" class="material-symbols-rounded ">arrow_back</span> Retour</button>
    <button class="white-button" onclick="sendToConso()"><span style="margin-right: 10px;" class="material-symbols-rounded ">send</span>Envoyer</button>
</div>

<div>
    <table class="sortable">
        <thead>
            <th class="no-sort">Numéro étudiant <span aria-hidden="true"></span></th>
            <th><button>Nom <span aria-hidden="true"></span></button></th>
            <th><button>Prénom <span aria-hidden="true"></span></button></th>
            <th><button>Groupe <span aria-hidden="true"></span></button></th>
            {% for matiere, note in bilans.0.notes.items %}
                <th><button>QCM {{ matiere }} (/20) <span aria-hidden="true"></span></button></th>
            {% endfor %}
            <th><button>Demande conso. <span aria-hidden="true"></span></button></th>
            <th> Matières demandées </th>
            <th class="no-sort desc">Commentaires</th>
            {% for matiere, note in bilans.0.notes.items %}
                <th>Conso. {{ matiere }}</th>
            {% endfor %}
        </thead>

        <tbody>
            {% for bilan in bilans %}
                <tr>
                    <td>{{ bilan.numE }}</td>
                    <td>{{ bilan.nom }}</td>
                    <td>{{ bilan.prenom }}</td>
                    <td>{{ bilan.groupe }}</td>
                    {% for matiere, note in bilan.notes.items %}
                        <td class="student-info">{{ note }}
                            <table class="info-table">
                                <thead>
                                    <th>Historique QCM {{ matiere }}</th>
                                </thead>
                                <tbody>
                                    {% for note_mat in bilan.notes_by_mat|get:matiere %}
                                        <tr>
                                            <td data-note="{{ note }}">{{ note_mat }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    {% endfor %}
                    <td>{% if bilan.demande == 'True' %} ✅ {% else %} ❌ {% endif %}</td>
                    <td>{{ bilan.demande_en }}</td>
                    <td>{{ bilan.desc }}</td>
                    {% for note in bilan.notes %}
                        <td><input type="checkbox"></td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
